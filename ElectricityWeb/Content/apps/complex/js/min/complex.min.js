var Tools;(function(t){var n=function(){function t(t,n){this.width=t,this.height=n}return t}();t.Size=n;var e=function(){function t(t,n){this.x=t,this.y=n}return t}();t.Position=e})(Tools||(Tools={}));var __extends=this.__extends||function(t,n){function e(){this.constructor=t}for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);e.prototype=n.prototype,t.prototype=new e},Visual;(function(t){var n=Tools.Size,e=function(){function t(){}return Object.defineProperty(t.prototype,"canvasObject",{get:function(){return this.object},enumerable:!0,configurable:!0}),t.prototype.init=function(t,n){this.object=t,t.selectable=n||!1,t.hasBorders=!1,t.hasControls=!1,t.hasRotatingPoint=!1},t}();t.VisualElement=e;var i=function(t){function n(){t.apply(this,arguments),this.connections=[]}return __extends(n,t),Object.defineProperty(n.prototype,"x",{get:function(){return this.canvasObject.left+this.canvasObject.width*this.canvasObject.scaleX/2},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this.canvasObject.top+this.canvasObject.height*this.canvasObject.scaleY/2},enumerable:!0,configurable:!0}),n.prototype.initSizable=function(n,e,i,o,r,c,a,s){this.canvas=e,n.left=i.x,n.top=i.y,n.width=o.width,n.height=o.height,n.fill=c||"grey",n.stroke=a||n.fill,n.strokeWidth=s||0,n.setShadow({color:"rgba(0, 0, 0, 0.15)",offsetX:4,offsetY:4});var l=this;n.on("mousedown",function(){return l.onClick()}),t.prototype.init.call(this,n,r)},n.prototype.onClick=function(){Application.instance.toolbar.activeTool.clickHandler.onElementClick(this)},n.prototype.connectWith=function(t){if(!this.isConnectedWith(t)){var n=(new a).initLine(this.canvas,this,t,!1,"grey");this.canvas.sendToBack(n.canvasObject),this.setConnection(n),t.setConnection(n)}},n.prototype.isConnectedWith=function(t){var n=!1;return this.connections.forEach(function(e){e.contains(t)&&(n=!0)}),n},n.prototype.setConnection=function(t){var n=this;this.connections.push(t);var e=function(){n.connections.forEach(function(t){t.updateNode(n)})};this.canvasObject.on({moving:e,scaling:e})},Object.defineProperty(n.prototype,"selected",{set:function(t){var n=Application.instance.canvas;this.canvasObject.animate("strokeWidth",t?4:0,{onChange:n.renderAll.bind(n)})},enumerable:!0,configurable:!0}),n}(e);t.SizableElement=i;var o=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.initRect=function(n,e,i,o,r){var c=new fabric.Rect,a=Application.instance.canvas;return t.prototype.initSizable.call(this,c,a,n,e,i,o,r,3),a.add(c),this},n}(i);t.RectElement=o;var r=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.initCircle=function(e,i,o,r){var c=new fabric.Circle,a=Application.instance.canvas;return c.radius=i,t.prototype.initSizable.call(this,c,a,e,new n(i,i),o,r),a.add(c),this},e}(i);t.CircleElement=r;var c=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.initImage=function(t,n,e,i){var o=Application.instance.canvas,r=this;return fabric.Image.fromURL(e,function(e){o.add(e),r.initSizable(e,o,t,n,i,"white")}),this},n}(i);t.ImageElement=c;var a=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.initLine=function(n,e,i,o,r,c){void 0===c&&(c=1),this.from=e,this.to=i;var a=new fabric.Line([e.x,e.y,i.x,i.y]);return a.strokeWidth=c,a.stroke=r,t.prototype.init.call(this,a,o),this.line=a,n.add(a),this},n.prototype.updateNode=function(t){t===this.from&&this.line.set({x1:this.from.x,y1:this.from.y}),t===this.to&&this.line.set({x2:this.to.x,y2:this.to.y})},n.prototype.contains=function(t){return this.from===t||this.to===t},n}(e);(function(){function t(t,n){var e=new fabric.Text("Value",{fontSize:14});e.left=n.canvasObject.left,e.top=n.canvasObject.top;var i=new fabric.Group([n.canvasObject,e]);t.add(i)}return t})()})(Visual||(Visual={}));var Ui;(function(t){var n=function(){function t(t,n,e,i,o){this.controls=[],this.app=t,this.x=n,this.y=e,this.height=i,this.elementSize=o}return t.prototype.createToggle=function(){var t=new e,n=this.controls.length*this.elementSize;t.initToggle(this.app.canvas,this,this.x+n,this.y,this.elementSize,this.height,"../Content/apps/complex/img/select.png"),this.controls.push(t)},t.prototype.onControlClicked=function(t){var n=this;this.controls.forEach(function(e){e.changeState(e===t),e===t&&(n.activeTool=e)})},t}();t.Toolbar=n;var e=function(){function t(){}return t.prototype.initToggle=function(t,n,e,o,r,c,a){var s=this;this.toolbar=n,this.size=r,this.tool=new i;var l=function(){return s.onClick(s)};fabric.Image.fromURL(a,function(n){n.width=r,n.height=c,n.left=e,n.top=o,n.selectable=!1,n.on("mousedown",l),s.object=n,t.add(n)})},t.prototype.onClick=function(t){t.toolbar.onControlClicked(t)},t.prototype.changeState=function(t){this.object.setShadow({color:"rgba(0, 0, 0, 0.15)",offsetX:0,offsetY:t?7:0})},Object.defineProperty(t.prototype,"clickHandler",{get:function(){return this.tool},enumerable:!0,configurable:!0}),t}(),i=function(){function t(){}return t.prototype.onElementClick=function(t){Application.instance.deselect(),t.selected=!0},t}()})(Ui||(Ui={}));var Application=function(){function t(){this.elements=[],this.canvas=new fabric.Canvas("canvas")}return Object.defineProperty(t,"instance",{get:function(){return null==this.instanceInternal&&(this.instanceInternal=new t),this.instanceInternal},enumerable:!0,configurable:!0}),t.prototype.init=function(){var t=(new Visual.RectElement).initRect(new Tools.Position(100,200),new Tools.Size(200,100),!0,"white","green"),n=(new Visual.CircleElement).initCircle(new Tools.Position(400,100),20,!1),e=(new Visual.ImageElement).initImage(new Tools.Position(400,100),new Tools.Size(100,100),"../Content/apps/complex/img/test.png",!0);t.connectWith(n),this.elements.push(t,n,e),this.toolbar=new Ui.Toolbar(this,0,0,100,100),this.toolbar.createToggle(),this.toolbar.createToggle(),this.toolbar.createToggle()},t.prototype.clear=function(){this.canvas.clear()},t.prototype.deselect=function(){this.elements.forEach(function(t){return t.selected=!1})},t}();Application.instance.init();var Input;(function(t){var n=function(){function t(){}return t}();t.InputController=n})(Input||(Input={}));var creator;(function(t){var n=function(){function t(t){this.canvas=t,this.interactable=!0}return t}();t.creator=n;var e=function(t){function n(n){t.call(this,n),this.interactable=!1}return __extends(n,t),n}(n);t.staticContentCreator=e})(creator||(creator={}));